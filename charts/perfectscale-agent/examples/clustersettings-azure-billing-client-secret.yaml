# Azure Billing integration with client_secret authentication
# Configure Azure billing integration using client_secret authentication method
#
# Setup Instructions:
# 1. Configure Azure billing export in your subscription
# 2. Create an Azure AD application and service principal
# 3. Grant the application appropriate permissions to access billing data
# 4. Generate a client secret for the application
# 5. Store the client secret in the Kubernetes secret below
# 6. Copy the client ID, tenant ID, and subscription ID to the configuration below
#
# Fields Description:
# azure_auth_type: Authentication type (client_secret)
# azure_client_id: Azure AD application (client) ID
# azure_client_secret: Azure AD application client secret (stored in Kubernetes secret)
# azure_subscription_id: Azure subscription ID
# azure_tenant_id: Azure AD tenant ID
# global_discount: Optional global discount configuration
#
# Documentation:
# https://docs.perfectscale.io/cloud-billing-integration/connecting-azure-cost-management
#
# NOTE: workload_identity authentication is the recommended method.
# See clustersettings-cloud-billing.yaml or clustersettings-azure-billing.yaml for workload_identity examples.
#
apiVersion: perfectscale.io/v1
kind: ClusterSettings
metadata:
  name: cluster-settings-main
  namespace: perfectscale
spec:
  profiles:
    pricing:
      - type: azure_billing
        name: azure-billing-export-secret
        assigned: true
        value:
          global_discount:
            percentage: 4
            start_date: 2025-01-02
          azure_auth_type: client_secret
          azure_client_id: "your-azure-client-id-here"
          azure_client_secret_from:
            secretKeyRef:
              name: azure-credentials
              key: client-secret
          azure_subscription_id: "your-azure-subscription-id-here"
          azure_tenant_id: "your-azure-tenant-id-here"

---
# Azure Client Secret
apiVersion: v1
kind: Secret
metadata:
  name: azure-credentials
  namespace: perfectscale
type: Opaque
stringData:
  client-secret: "your-azure-client-secret-here"

